{% extends 'base.html' %}
{% block meta %}<title>Edit Product – Treble Eshop</title>{% endblock meta %}

{% block content %}

<section class="mx-auto max-w-5xl px-4 sm:px-6 lg:px-8 pt-20 pb-12">
  <!-- Back -->
  <a href="{% url 'main:show_main' %}" class="inline-flex items-center gap-2 text-sm text-gray-600 hover:text-gray-900">
    <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-width="2" d="M15 18l-6-6 6-6"/></svg>
    Back to Product List
  </a>

  <div class="mt-4 grid gap-8 md:grid-cols-2">
    <!-- Form card -->
    <div class="rounded-2xl bg-white ring-1 ring-gray-200 shadow-sm p-6 sm:p-8 form-style">
      <h1 class="text-2xl font-bold text-gray-900 mb-6">Edit Product</h1>

      <form method="POST" enctype="multipart/form-data" class="space-y-5">
        {% csrf_token %}

        {% for field in form %}
          <div>
            <label for="{{ field.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
              {{ field.label }}
            </label>
            <div class="w-full">
              {{ field }}
            </div>
            {% if field.help_text %}
              <p class="mt-1 text-xs text-gray-500">{{ field.help_text }}</p>
            {% endif %}
            {% for error in field.errors %}
              <p class="mt-1 text-sm text-red-600">{{ error }}</p>
            {% endfor %}
          </div>
        {% endfor %}

        <div class="flex flex-col sm:flex-row gap-3 pt-6 border-t border-gray-200">
          <a href="{% url 'main:show_main' %}"
             class="order-2 sm:order-1 px-5 py-2.5 rounded-lg ring-1 ring-gray-300 text-gray-700 text-center hover:bg-gray-50">
            Cancel
          </a>
          <button type="submit"
                  class="order-1 sm:order-2 flex-1 px-5 py-2.5 rounded-lg bg-[--color-button] text-white font-semibold hover:bg-[--color-button-hover]">
            Save Changes
          </button>
        </div>
      </form>
    </div>

    <!-- Live preview -->
    <aside class="rounded-2xl bg-white ring-1 ring-gray-200 shadow-sm p-6 sm:p-8">
      <h2 class="text-sm font-medium text-gray-700 mb-3">Preview</h2>
      <div class="aspect-square rounded-xl bg-gray-50 ring-1 ring-gray-200 overflow-hidden flex items-center justify-center">
        {% if product.thumbnail %}
          <img id="thumbPreview" src="{{ product.thumbnail }}" alt="Thumbnail preview" class="max-h-full max-w-full">
        {% else %}
          <img id="thumbPreview" class="hidden max-h-full max-w-full" />
          <span class="text-gray-400">No image</span>
        {% endif %}
      </div>
      <p class="mt-3 text-xs text-gray-500">Preview akan berubah saat kamu mengedit field “Thumbnail”.</p>
    </aside>
  </div>
</section>

<!-- Styling generik untuk semua form di dalam .form-style -->
<style type="text/tailwindcss">
  @layer base {
    .form-style :where(input:not([type="checkbox"]):not([type="radio"]), select, textarea) {
      @apply block w-full rounded-md border border-gray-300 bg-white
             px-3 py-2 text-sm text-gray-900 placeholder:text-gray-400 outline-none
             focus:border-[--color-button] focus:ring-2 focus:ring-[--color-button] transition;
    }
    .form-style textarea { @apply h-32 resize-y; }
  }
</style>

<script>
  // Live preview untuk field bernama "thumbnail" (mendukung file atau URL text)
  (function () {
    const img = document.getElementById('thumbPreview');
    const urlInput = document.querySelector('input[name="thumbnail"]:not([type="file"])');
    const fileInput = document.querySelector('input[type="file"][name="thumbnail"]');

    function show(src) {
      if (!img) return;
      if (src) {
        img.src = src;
        img.classList.remove('hidden');
      }
    }

    if (urlInput) {
      urlInput.addEventListener('input', () => show(urlInput.value.trim()));
    }
    if (fileInput) {
      fileInput.addEventListener('change', () => {
        const [file] = fileInput.files || [];
        if (file) show(URL.createObjectURL(file));
      });
    }
  })();
</script>
{% endblock %}
